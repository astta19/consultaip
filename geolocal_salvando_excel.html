<html><head><base href="">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Check</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
<style>
    body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        line-height: 1.6;
        margin: 0;
        padding: 20px;
        background-color: #080101;
    }
    .container {
        max-width: 400px;
        margin: 0 auto;
        background-color: #615656;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1 {
        color: #000000;
        text-align: center;
    }
    #map {
        width: 100%;
        height: 300px;
        margin-bottom: 20px;
        border: 1px solid #ddd;
        border-radius: 4px;
        display: none;
    }
    .input-group {
        margin-bottom: 15px;
    }
    label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
    }
    input[type="text"], textarea {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
    }
    textarea {
        height: 100px;
        resize: vertical;
    }
    button {
        background-color: #07366d;
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
    }
    button:hover {
        background-color: #28c205;
    }
    #status {
        margin-top: 20px;
        padding: 10px;
        background-color: #e7f3fe;
        border-left: 6px solid #010c16;
    }
    #checkInList {
        margin-top: 20px;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 10px;
        max-height: 300px;
        overflow-y: auto;
        display: none;
    }
    .check-in-item {
        background-color: #f9f9f9;
        border: 1px solid #eee;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 4px;
    }
</style>
</head>

<body>

    
    <div class="container">
        <center><img width="75" height="75" src="security.png" alt=""/></center>
        <h1>TMO - Vigia</h1>
        <a href='qrcode.html'><button>escanear qr</button></a>
    
        <div id="map"></div>
        <div class="input-group">
            <form enctype=multipart/form-data action="https://api.sheetmonkey.io/form/md3HnKnS8cojZ2M3ZJA4tM" method="post">
                
                <input type='file' name='arquivo'/>
               
                
            <label>Nome: <input type="text" name="Example Header" required /></label>
            
            <label>Local: <input type="text" name="Example Header" required /></label>  

            <label>Observação: <input type="text" name="Example Header" required /></label> 
            
            <label>Data e Hora:<input type="datetime-local" required/></label>
            
           
            
        </div>
        <div class="input-group">
            
            
        </div>
        <button id="checkInBtn">Check do local</button>
        <button id="exportBtn">Sheets</button>
        
        <div id="status">Status: Pronto para check-in</div>
    </form>
     

        <div id="checkInList">
        <!-- Os check-ins serão inseridos aqui dinamicamente -->

        
        </div>
    </div>

    <script>
        let map, marker;
        let checkIns = [];

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: {lat: -14.235, lng: -51.925},
                zoom: 4
            });
        }

        function setView(){


        }

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(saveCheckIn, handleLocationError);
            } else {
                updateStatus("Geolocalização não é suportada por este navegador.");
            }
        }

        function saveCheckIn(position) {
            const { latitude, longitude, accuracy } = position.coords;
            const timestamp = new Date().toISOString();
            const locationName = document.getElementById('locationName').value;
            const locationName1 = document.getElementById('locationName1').value;
            const observation = document.getElementById('observation').value;

            const checkInData = {

                Local: locationName,
                Nome: locationName1,
                latitude,
                longitude,
                accuracy,
                timestamp,
                observation
            };

            checkIns.push(checkInData);
            updateMap(latitude, longitude);
            displayCheckIn(checkInData);
            updateStatus("Check-in realizado com sucesso.");

            // Limpar campos após o check-in
            document.getElementById('locationName').value = '';
            document.getElementById('locationName1').value = '';
            document.getElementById('observation').value = '';
        }

        function updateMap(latitude, longitude) {
            const latLng = new google.maps.LatLng(latitude, longitude);

            if (!marker) {
                marker = new google.maps.Marker({
                    position: latLng,
                    map: map
                });
            } else {
                marker.setPosition(latLng);
            }

            map.panTo(latLng);
            map.setZoom(15);
        }

        function displayCheckIn(checkInData) {
            const list = document.getElementById('checkInList');
            const item = document.createElement('div');
            item.className = 'check-in-item';
            item.className1 = 'check-in-item';
            item.innerHTML = `
                <strong>${checkInData.name}</strong><br>
                <strong>${checkInData.name1}</strong><br>
                Latitude: ${checkInData.latitude.toFixed(6)}<br>
                Longitude: ${checkInData.longitude.toFixed(6)}<br>
                Precisão: ${checkInData.accuracy.toFixed(2)}m<br>
                Data/Hora: ${moment(checkInData.timestamp).format('DD/MM/YYYY HH:mm:ss')}<br>
                Observação: ${checkInData.observation || 'Nenhuma'}
            `;
            list.insertBefore(item, list.firstChild);
        }

        function exportToExcel() {
            if (checkIns.length === 0) {
                updateStatus("Nenhum dado para exportar.");
                return;
            }

            const worksheet = XLSX.utils.json_to_sheet(checkIns);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "Check-ins");

            const excelBuffer = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });
            saveExcelFile(excelBuffer, 'check-ins.xlsx');
        }

        function saveExcelFile(buffer, fileName) {
            const data = new Blob([buffer], { type: 'application/octet-stream' });
            const link = document.createElement('a');
            link.href = window.URL.createObjectURL(data);
            link.download = fileName;
            link.click();
            updateStatus("Dados exportados para Excel com sucesso.");
        }

        function updateStatus(message) {
            document.getElementById('status').textContent = `Status: ${message}`;
        }

        function handleLocationError(error) {
            let errorMessage;
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    errorMessage = "Usuário negou a solicitação de Geolocalização.";
                    break;
                case error.POSITION_UNAVAILABLE:
                    errorMessage = "Informação de localização indisponível.";
                    break;
                case error.TIMEOUT:
                    errorMessage = "Tempo de solicitação de localização do usuário expirou.";
                    break;
                default:
                    errorMessage = "Ocorreu um erro desconhecido.";
            }
            updateStatus(errorMessage);
        }

        document.getElementById('checkInBtn').addEventListener('click', getLocation);
        document.getElementById('exportBtn').addEventListener('click', exportToExcel);

        window.onload = initMap;
    </script>

    <script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&callback=initMap"></script>

</body>
</html>



    




