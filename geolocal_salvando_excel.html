<html><head>
    
<meta name="theme-color" content="#000000">
<link rel="manifest" href="manifest.json">
<base href="">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Check</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
<style>
    body {
        font-family: monospace;
        line-height: 1.6;
        margin: 0;
        padding: 20px;
        background-color: #080101;
    }
    .container {
        max-width: 400px;
        margin: 0 auto;
        background-color: #615656;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1 {
        color: #000000;
        text-align: center;
    }
    #map {
        width: 100%;
        height: 300px;
        margin-bottom: 20px;
        border: 1px solid #ddd;
        border-radius: 4px;
        display: none;
    }
    .input-group {
        margin-bottom: 15px;
    }
    label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
    }
    input[type="text"], textarea {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
    }
    textarea {
        height: 100px;
        resize: vertical;
    }
    button {
        background-color: #07366d;
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
    }
    button:hover {
        background-color: #28c205;
    }
    #status {
        margin-top: 20px;
        padding: 10px;
        background-color: #e7f3fe;
        border-left: 6px solid #010c16;
    }
    #checkInList {
        margin-top: 20px;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 10px;
        max-height: 300px;
        overflow-y: auto;
        display: none;
    }
    .check-in-item {
        background-color: #f9f9f9;
        border: 1px solid #eee;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 4px;
    }

    @media only screen and (max-width: 600px) {
    /* Adapte elementos como menus, colunas, e imagens para melhorar a visualização em dispositivos móveis. */
}

</style>
</head>
<link rel="shortcut icon" type="imagex/png" href="security-guard.png">
<body>

    
    <div class="container">
        <center><img width="75" height="75" src="security.png" alt=""/></center>
        <h1>TMO - Vigia</h1>
       
    
        <div id="map"></div>
        <div class="input-group">
            <form enctype=multipart/form-data action="https://api.sheetmonkey.io/form/md3HnKnS8cojZ2M3ZJA4tM" method="post">
                
                <input type='file' name='arquivo' multiple='multiple'/>
              
                
                <progress id="sheetmonkey-upload-progress" max="100"></progress>
               
                
            <label>Nome: <input type="text" name="Nome" required /></label>
            
            <label>Local:</a>
                <select name="local">
                    <option value="hcc1">HCC 1</option>
                    <option value="hcc2">HCC 2</option>
                    <option value="hcc3">HCC 3</option>
                    <option value="hcc4">HCC 4</option>
                    <option value="hcc5">HCC 5</option>
                    <option value="hcc6">HCC 6</option>
                    <option value="hcc7">HCC 7</option>
                    <option value="hcc8">HCC 8</option>
                </select>

                <label>Ocorrência:</a>
                    <select name="local">
                        <option value="sim">sim</option>
                        <option value="nao">não</option>
                        </select>
                        </label>

            <input type="hidden" name="Created" value="x-sheetmonkey-current-date-time" /></label>  

            <label>Observação: <input type="text" name="Observação" required /></label> 

            
            
            
            
           
            
        </div>
        <div class="input-group">
            
            
        </div>
        <center><button id="checkInBtn">Enviar</button></center>
    </form>
        
        
        <div id="status">Status: Pronto</div>
  
     

        <div id="checkInList">
        <!-- Os check-ins serão inseridos aqui dinamicamente -->

        
        </div>
    </div>

    <script>
         var x=document.getElementById("demo");		
    function getLocation()
      {
      if (navigator.geolocation)
      {
      navigator.geolocation.getCurrentPosition(showPosition,showError);
      }
      else{x.innerHTML="Seu browser não suporta Geolocalização.";}
      }
      function showPosition(position)
      {
      x.innerHTML="Latitude: " + position.coords.latitude +
      "<br>Longitude: " + position.coords.longitude; 
	  }
	
	
	
	  console.log(getLocation());	
	
	  function showError(error)
      {
      switch(error.code)
      {
      case error.PERMISSION_DENIED:
      x.innerHTML="Usuário rejeitou a solicitação de Geolocalização."
      break;
      case error.POSITION_UNAVAILABLE:
      x.innerHTML="Localização indisponível."
      break;
      case error.TIMEOUT:
      x.innerHTML="A requisição expirou."
      break;
      case error.UNKNOWN_ERROR:
      x.innerHTML="Algum erro desconhecido aconteceu."
      break;
    }
  }
        let map, marker;
        let checkIns = [];

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: {lat: -14.235, lng: -51.925},
                zoom: 4
            });
        }

        function setView(){


        }

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(saveCheckIn, handleLocationError);
            } else {
                updateStatus("Geolocalização não é suportada por este navegador.");
            }
        }

        function saveCheckIn(position) {
            const { latitude, longitude, accuracy } = position.coords;
            const timestamp = new Date().toISOString();
            const locationName = document.getElementById('locationName').value;
            const locationName1 = document.getElementById('locationName1').value;
            const observation = document.getElementById('observation').value;

            const checkInData = {

                Local: locationName,
                Nome: locationName1,
                latitude,
                longitude,
                accuracy,
                timestamp,
                observation
            };

            checkIns.push(checkInData);
            updateMap(latitude, longitude);
            displayCheckIn(checkInData);
            updateStatus("Check-in realizado com sucesso.");

            // Limpar campos após o check-in
            document.getElementById('locationName').value = '';
            document.getElementById('locationName1').value = '';
            document.getElementById('observation').value = '';
        }

        function updateMap(latitude, longitude) {
            const latLng = new google.maps.LatLng(latitude, longitude);

            if (!marker) {
                marker = new google.maps.Marker({
                    position: latLng,
                    map: map
                });
            } else {
                marker.setPosition(latLng);
            }

            map.panTo(latLng);
            map.setZoom(15);
        }

        function displayCheckIn(checkInData) {
            const list = document.getElementById('checkInList');
            const item = document.createElement('div');
            item.className = 'check-in-item';
            item.className1 = 'check-in-item';
            item.innerHTML = `
                <strong>${checkInData.name}</strong><br>
                <strong>${checkInData.name1}</strong><br>
                Latitude: ${checkInData.latitude.toFixed(6)}<br>
                Longitude: ${checkInData.longitude.toFixed(6)}<br>
                Precisão: ${checkInData.accuracy.toFixed(2)}m<br>
                Data/Hora: ${moment(checkInData.timestamp).format('DD/MM/YYYY HH:mm:ss')}<br>
                Observação: ${checkInData.observation || 'Nenhuma'}
            `;
            list.insertBefore(item, list.firstChild);
        }

        function exportToExcel() {
            if (checkIns.length === 0) {
                updateStatus("Nenhum dado para exportar.");
                return;
            }

            const worksheet = XLSX.utils.json_to_sheet(checkIns);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "Check-ins");

            const excelBuffer = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });
            saveExcelFile(excelBuffer, 'check-ins.xlsx');
        }

        function saveExcelFile(buffer, fileName) {
            const data = new Blob([buffer], { type: 'application/octet-stream' });
            const link = document.createElement('a');
            link.href = window.URL.createObjectURL(data);
            link.download = fileName;
            link.click();
            updateStatus("Dados exportados para Excel com sucesso.");
        }

        function updateStatus(message) {
            document.getElementById('status').textContent = `Status: ${message}`;
        }

        function handleLocationError(error) {
            let errorMessage;
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    errorMessage = "Usuário negou a solicitação de Geolocalização.";
                    break;
                case error.POSITION_UNAVAILABLE:
                    errorMessage = "Informação de localização indisponível.";
                    break;
                case error.TIMEOUT:
                    errorMessage = "Tempo de solicitação de localização do usuário expirou.";
                    break;
                default:
                    errorMessage = "Ocorreu um erro desconhecido.";
            }
            updateStatus(errorMessage);
        }

        document.getElementById('checkInBtn').addEventListener('click', getLocation);
        document.getElementById('exportBtn').addEventListener('click', exportToExcel);

        window.onload = initMap;
    </script>

    <script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&callback=initMap"></script>

</body>
</html>







